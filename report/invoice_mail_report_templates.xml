<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="custom_header" inherit_id="l10n_cl.custom_header">
        <span name="company_activity" position="replace">
            <span name="company_activity" class="fst-italic" t-field="doc.company_name or 'N/A'"/>
        </span>
        <xpath expr="//div[@name='regional-office']" position="inside">
            <span t-field="doc.partner_name or 'N/A'"/>
        </xpath>
    </template>

    <template id="informations" inherit_id="l10n_cl.informations">
        <xpath expr="//div[@id='references']" position="replace">
        <t t-if="doc">
            <table class="table table-sm o_main_table small" name="invoice_references">
                <thead>
                    <tr>
                        <th name="th_reference_origin" class="text-center"><span>Campo</span></th>
                        <th name="th_reference_value" class="text-start"><span>Valor</span></th>
                    </tr>
                </thead>
                <tbody class="invoice_tbody">
                    <tr>
                        <td class="text-start"><span>Nombre del Documento</span></td>
                        <td class="text-start"><span t-field="doc.name"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>RUT Emisor</span></td>
                        <td class="text-start"><span t-field="doc.company_rut"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Razón Social Emisor</span></td>
                        <td class="text-start"><span t-field="doc.company_name"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>RUT Receptor</span></td>
                        <td class="text-start"><span t-field="doc.partner_rut"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Razón Social Receptor</span></td>
                        <td class="text-start"><span t-field="doc.partner_name"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Dirección Receptor</span></td>
                        <td class="text-start"><span t-field="doc.partner_address or 'N/A'"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Fecha de Emisión</span></td>
                        <td class="text-start"><span t-field="doc.date_emission"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Fecha de Vencimiento</span></td>
                        <td class="text-start"><span t-field="doc.date_due"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Monto Neto</span></td>
                        <td class="text-start"><span t-field="doc.amount_net" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>IVA</span></td>
                        <td class="text-start"><span t-field="doc.amount_tax" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/></td>
                    </tr>
                    <tr>
                        <td class="text-start"><span>Total</span></td>
                        <td class="text-start"><span t-field="doc.amount_total" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/></td>
                    </tr>
                </tbody>
            </table>
            <t t-if="doc.line_ids">
                <h4 class="mt-4">Detalle de Referencias</h4>
                <table class="table table-sm o_main_table small">
                    <thead>
                        <tr>
                            <th>Descripción</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="doc.line_ids" t-as="line">
                            <tr>
                                <td><span t-field="line.product_name"/></td>
                                <td><span t-field="line.quantity"/></td>
                                <td><span t-field="line.price_unit" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/></td>
                                <td><span t-field="line.subtotal" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/></td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </t>
        </t>
        </xpath>
    </template>

    <template id="barcode_stamp_footer" inherit_id="l10n_cl.report_invoice_document">
        <xpath expr="//div[@name='stamp']" position="inside">
            <t t-if="doc.xml_file">
                <t t-set="barcode_stamp" t-value="doc.xml_file"/>
                <t t-if="barcode_stamp">
                    <img class="img-fluid" t-attf-src="data:image/*;base64,{{barcode_stamp}}"/>
                    <p t-att-style="'color: %s;' % doc.company_id.primary_color" class="text-center small">
                        Timbre Electrónico SII<br />
                        Resolución Nº: <span t-field="doc.company_rut"/>
                        de Fecha: <span t-field="doc.date_emission" t-options='{"widget": "date"}'/>
                        <span name="verification_url">Verifique documento en www.sii.cl</span>
                    </p>
                </t>
            </t>
        </xpath>
        <xpath expr="//div[@name='transferable-legend']" position="inside">
            <t t-if="doc.amount_tax">
                The VAT tax of this boleta is: <span t-out="doc.amount_tax" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
            </t>
        </xpath>
    </template>

</odoo>
